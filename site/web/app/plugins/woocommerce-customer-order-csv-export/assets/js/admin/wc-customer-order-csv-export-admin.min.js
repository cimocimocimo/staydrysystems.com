"use strict";(function(){var y={}.hasOwnProperty;jQuery(document).ready(function(i){var d,e,t,r,n,a,c,s,_,l,u,p,o,m,f,v,h,x,w,b,g;return x={},t=i.WCBackboneModal.View,g=function(o,r,n,a,c,i){var d,s,_;return _=o.length,c=c||25,i=i||_,s=0,d=function(){var e,t;for(t=+new Date,e=s;s<_&&s-e<i&&new Date-t<50;)r.call(n,o[s]),s+=1;return s<_?setTimeout(d,c):a(o)},setTimeout(d,25)},w=function(e){var t,r;return r={},t=function(e,t){var o;t.name=t.name.replace("[]",""),null!=(o=r[t.name])?i.isArray(o)?o.push(t.value):r[t.name]=[o,t.value]:r[t.name]=t.value},i.each(i(e).serializeArray(),t),r},b=function(e){return i("#wc-backbone-modal-dialog .modal-close").trigger("click"),e.button_class=e.button_class||"",new t({target:"wc-customer-order-csv-export-modal",string:e})},l=function(e,t){var r,o;return t=t||{},r={action:"wc_customer_order_export_create_export",security:wc_customer_order_csv_export_admin.create_export_nonce,export_type:t.export_type||"orders",export_method:t.export_method||"download",output_type:t.output_type||"csv",export_format:t.export_format||"default",automation_id:t.automation_id||"",filename:t.filename||"",mark_as_exported:null==t.mark_as_exported||t.mark_as_exported,add_notes:t.add_notes,batch_enabled:t.batch_enabled,export_query:e},o=wp.template("wc-customer-order-csv-export-modal-body-export-started"),b({title:wc_customer_order_csv_export_admin.i18n.export_started,body:o({export_method:r.export_method,batch_enabled:r.batch_enabled}),action:r.batch_enabled?wc_customer_order_csv_export_admin.i18n.cancel:wc_customer_order_csv_export_admin.i18n.close,button_class:r.batch_enabled?"cancel-export":"",batch_enabled:r.batch_enabled}),i.post(ajaxurl,r).done(function(t){var o;if(i("#wc-backbone-modal-dialog").length)return!1===t.success?p({title:t.data.title,message:t.data.message}):(i("#wc-backbone-modal-dialog").addClass("wc-customer-order-csv-export-"+t.export_id).data("wc-customer-order-csv-export-id",t.export_id),r.batch_enabled?s(t.export_id):(o=!1,x[t.export_id]=setInterval(function(){if(!o)return o=!0,i.get(t.status_url).done(function(e){return"string"==typeof e?p():(o=!1)===e.success?(a(t.export_id),p(e.data)):"completed"===e.data.status?u(e.data):void 0}).fail(function(e,t,o){return p()})},2e3)))}).fail(function(e,t,o){return p()})},h=function(e){var t,o,r;return r=wp.template("wc-customer-order-csv-export-modal-body-export-started"),b({title:wc_customer_order_csv_export_admin.i18n.export_resumed,body:r({export_method:"download"})}),t=i(".file_actions .resume[data-export-id="+e+"]").parents("tr"),(o=t.find(".export_status mark")).removeClass("paused").addClass("processing"),t.find(".file_actions .resume").addClass("disabled").attr("href","").blur(),t.find(".file_actions .cancel").removeClass("cancel").addClass("delete"),s(e).then(function(e){return o.removeClass("processing").addClass(e),t.find(".file_actions .resume").removeClass("disabled").removeClass("resume").addClass("download")})},s=function(t){return window.onbeforeunload=function(){return wc_customer_order_csv_export_admin.i18n.confirm_export_cancel},i(document).on("wc_customer_order_export_background_export_batch_progress_"+t,function(e,t){return i(".wc-customer-order-csv-export-progress").val(t.percentage)}),i(document).on("click","#btn-ok.cancel-export",function(e){if(confirm(wc_customer_order_csv_export_admin.i18n.confirm_export_cancel))return window.onbeforeunload=null,wc_customer_order_export_background_export_batch_handler.cancelled=t}),wc_customer_order_export_background_export_batch_handler.process_job(t).then(function(e){return window.onbeforeunload=null,i(".wc-customer-order-csv-export-progress").val(100),u(e.data)}).catch(function(e){return i(".wc-customer-order-csv-export-progress").hide(),p(e.data)})},u=function(e){var t;if("download"===e.method||"local"===e.method||"completed"===e.transfer_status)return t=wp.template("wc-customer-order-csv-export-modal-body-export-completed"),b({title:wc_customer_order_csv_export_admin.i18n.export_completed,body:t({export_method:e.method,download_url:e.download_url,mark_as_exported:e.mark_as_exported}),action:wc_customer_order_csv_export_admin.i18n.done}),"download"===e.method&&(window.location.href=e.download_url),a(e.export_id),e.status},p=function(e){var t,o,r,n=0<arguments.length&&void 0!==e?e:null;if(r=wc_customer_order_csv_export_admin.i18n.unexpected_error,t=wc_customer_order_csv_export_admin.i18n.unexpected_error_message,(o=null)!=n){if(null!=n.status)switch(o=n.status,n.status){case"not-found":r=wc_customer_order_csv_export_admin.i18n.export_not_found;break;case"failed":r=wc_customer_order_csv_export_admin.i18n.export_failed;break;case"completed":r="failed"===n.transfer_status?wc_customer_order_csv_export_admin.i18n.export_transfer_failed:wc_customer_order_csv_export_admin.i18n.export_completed}else null!=n.title&&(r=n.title);null!=n.message&&(t=n.message)}return b({title:r,body:'<p><span class="dashicons dashicons-warning"></span> '+t+"</p>",action:wc_customer_order_csv_export_admin.i18n.close}),o},a=function(e){return i.get(ajaxurl,{action:"wc_plugin_framework_customer_order_csv_export_dismiss_notice",messageid:"wc_customer_order_export_finished_"+e})},wc_customer_order_csv_export_admin.settings_page===pagenow&&("export"!==(m=wc_customer_order_csv_export_admin.current_tab)&&"automations"!==m||i(".js-automation-output-type, .js-automation-export-type, .js-auto-export-trigger").change(function(){var o,r,n;return n=i(".js-automation-output-type:checked").val(),r=i(".js-automation-export-type:checked").val(),o=i(".js-auto-export-trigger").val(),i(".js-output-type-field, .js-export-type-field").closest("tr").hide(),i(".js-output-type-field").each(function(e,t){if(i(t).hasClass("show_if_"+n))return i(t).hasClass("show_if_"+r)||!i(t).hasClass("js-export-type-field")?i(t).closest("tr").show():void 0}),i(".js-export-type-field").each(function(e,t){if(i(t).hasClass("show_if_"+r)&&(i(t).hasClass("show_if_"+n)||!i(t).hasClass("js-output-type-field")))return i(t).hasClass("show_if_"+o)||!i(t).hasClass("js-action-field")?i(t).closest("tr").show():void 0})}).change(),"export"===wc_customer_order_csv_export_admin.current_tab&&(o={dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0,showOn:"button",buttonImage:wc_customer_order_csv_export_admin.calendar_icon_url,buttonImageOnly:!0},i("#start_date").datepicker(o),i("#end_date").datepicker(o),i('input[name="type"]').change(function(){var e;return e=i("#subscription_orders").closest("table.form-table").add(i("#subscription_orders").closest("table.form-table").prev("h2")),"orders"===i(this).val()?e.show():e.hide()}),i("#mainform").submit(function(e){var t,o,r,n,a,c,i;for(n in e.preventDefault(),a=(r=w(this)).output_type,t={export_type:o=r.type,export_method:"download",output_type:r.output_type,export_format:r[a+"_"+o+"_export_format"],filename:r[a+"_"+o+"_filename"],mark_as_exported:null!=(c=r[o+"_mark_as_exported"])?c:0,batch_enabled:null!=(i=r.enable_batch_processing)?i:0,add_notes:r[a+"_add_notes"]},r)y.call(r,n)&&(r[n],/(?:_mark_as_exported|_export_format|_filename)$/.test(n)&&delete r[n]);return delete r.output_type,delete r.type,delete r.add_notes,delete r._wp_http_referer,delete r._wpnonce,l(r,t)})),"export_list"===wc_customer_order_csv_export_admin.current_tab&&(i(".file_actions").find(".delete").on("click",function(e){if(!confirm(wc_customer_order_csv_export_admin.i18n.confirm_export_delete))return e.preventDefault()}),i(".file_actions").find(".cancel").on("click",function(e){if(!confirm(wc_customer_order_csv_export_admin.i18n.confirm_export_cancel))return e.preventDefault()}),i(".file_actions").find(".transfer, .email").on("click",function(e){if(!confirm(wc_customer_order_csv_export_admin.i18n.confirm_export_transfer))return e.preventDefault()}),i(".file_actions").find(".resume").on("click",function(e){if(e.preventDefault(),!i(e.target).hasClass("disabled"))return h(i(e.target).data("export-id"))})),"automations"===wc_customer_order_csv_export_admin.current_tab&&(i(".automation-slider").on("click",function(e){var t,o,r,n;return e.preventDefault(),t=i(this).data("automation-id"),o=i(this).siblings("input"),r={action:"wc_customer_order_export_admin_toggle_automation",automation_id:t,new_state:(n=o.is(":checked"))?0:1,nonce:wc_customer_order_csv_export_admin.security.toggle_automation_nonce},i.post(ajaxurl,r).done(function(e){var t;return t=null!=e.data?e.data:wc_customer_order_csv_export_admin.i18n.unexpected_error,e.success?o.prop("checked",!n):alert(t)}).fail(function(e,t,o){return alert(wc_customer_order_csv_export_admin.i18n.unexpected_error)})}),i(".wp-list-table.automations .actions .delete").on("click",function(e){if(!confirm(wc_customer_order_csv_export_admin.i18n.confirm_delete_automation))return e.preventDefault()}),i(".js-automation-export-type").on("change",function(e){var t,o;return o=i(".js-automation-export-type:checked").val(),t=i("#statuses.js-export-type-field").closest("table").prev(),"orders"===o?t.show():t.hide()}).change(),e={ftp:i(".js-auto-export-ftp-field:first").closest("table"),http_post:i(".js-auto-export-http-post-field:first").closest("table"),email:i(".js-auto-export-email-field:first").closest("table")},i(".js-auto-export-trigger").change(function(){var e,t;return t=i(this).val(),e=i(".js-auto-export-schedule-field").closest("tr"),"immediate"===t?e.hide():e.show()}).change(),i(".js-auto-export-method").change(function(){var r;return"local"===(r=i(this).val())?i(this).next("span.description").show():i(this).next("span.description").hide(),i.each(e,function(e,t){var o;return t[o=e===r?"show":"hide"]().prev()[o]()})}).change(),i(".js-auto-export-timepicker").timepicker({step:5}),i("select.js-auto-export-ftp-security").change(function(){var e,t,o;if(e=i(".js-auto-export-ftp-port"),t=Number(e.val(),10),o=i(this).val(),""===t||-1<[21,22,990].indexOf(t))return"sftp"===o?e.val(22):"ftp_ssl"===o?e.val(990):e.val(21)}).change(),i(".edit-automation-form").closest("form").on("submit",function(e){if("Manual"===i(".js-automation-name").val())return e.preventDefault(),alert(wc_customer_order_csv_export_admin.i18n.automation_name_error)}),i(".js-auto-export-test-button").on("click",function(){return i("<input>").attr({type:"hidden",id:"wc_customer_order_export_test_method",name:"wc_customer_order_export_test_method",value:i(this).data("method")}).appendTo(".woocommerce form")})),"custom_formats"===wc_customer_order_csv_export_admin.current_tab&&(i(".format_actions").find(".delete:not(.disabled)").on("click",function(e){if(!confirm(wc_customer_order_csv_export_admin.i18n.confirm_format_delete))return e.preventDefault()}),wc_customer_order_csv_export_admin.display_load_mapping_modal&&b({title:wc_customer_order_csv_export_admin.i18n.load_mapping,body:i("#tmpl-wc-customer-order-csv-export-modal-body-load-mapping").html(),action:wc_customer_order_csv_export_admin.i18n.load,button_class:"button-primary"}),i(document.body).on("click.wp-toggle-checkboxes","thead .sv-check-column :checkbox, tfoot .sv-check-column :checkbox",function(e){var t,o,r;t=i(this).closest("table"),o=i(this).prop("checked"),r=e.shiftKey||i(this).data("wp-toggle"),t.children("tbody").filter(":visible").children().children(".check-column").find(":checkbox").prop("checked",function(){return!i(this).is(":hidden,:disabled")&&(r?!i(this).prop("checked"):!!o)}),t.children("thead, tfoot").filter(":visible").children().children(".check-column").find(":checkbox").prop("checked",function(){return!r&&!!o})}),i(".js-row-type").change(function(){var e,t,o,r;return r=i(".js-show-if-single-order-format").closest("tr"),o=(e=i("select.js-field-key")).find('option[value="line_items"]'),t=e.find('option[value^="item_"]'),"order"===i(this).val()?(r.show(),o.prop("disabled",!1),t.prop("disabled",!0)):(r.hide(),o.prop("disabled",!0),t.prop("disabled",!1),i("#items_format").val("pipe_delimited").change()),e.not('[name*="[__INDEX__]"]').removeClass("enhanced").select2("destroy"),i(document.body).trigger("wc-enhanced-select-init")}).change(),d=i(".wc-customer-order-csv-export-field-mapping"),r=function(e,t){var o,r,n,a=0<arguments.length&&void 0!==e?e:{},c=1<arguments.length&&void 0!==t&&t;if(r=d.find(".field-mapping-__INDEX__"),n=d.find("tbody tr").length-2,(o=i(r.prop("outerHTML").replace(/__INDEX__/g,n))).find(".enhanced").removeClass("enhanced"),a.key&&(o.find(".js-field-key").val(a.key),"meta"===a.key?(o.find(".js-field-meta-key-label").show(),a.meta_key&&o.find(".js-field-meta-key").val(a.meta_key)):"static"===a.key&&(o.find(".js-field-static-value-label").show(),a.static_value&&o.find(".js-field-static-value").val(a.static_value))),a.name&&o.find(".js-field-name").val(a.name),r.before(o),d.find(".no-field-mappings").addClass("hide"),d.find("tfoot .js-remove-field-mapping").removeClass("hide"),c)return i(document.body).trigger("wc-enhanced-select-init")},v=function(e,t,o){var r,n=1<arguments.length&&void 0!==t?t:400,a=2<arguments.length&&void 0!==o?o:null;return a=a||function(){},r=function(){return d.find("tbody tr:visible").length<1&&(d.find(".no-field-mappings").removeClass("hide"),d.find(".js-remove-field-mapping").addClass("hide")),d.find('th.check-column input[type="checkbox"]').removeAttr("checked")},n?i.when(i(e).closest("tr.field-mapping").fadeOut(n,function(){var e;return e=i(this),setTimeout(function(){return e.remove()},1)})).then(function(){return r(),setTimeout(a,1)}):(i(e).closest("tr.field-mapping").remove(),r(),a())},f=function(){var r;return r=0,d.find("tr.field-mapping").each(function(e,t){if(!i(t).hasClass("field-mapping-__INDEX__"))return i(t).removeClass(function(e,t){var o,r;if(r=new RegExp("field-mapping-([0-9])*","g"),o=t.match(r))return o[0]}),i(t).addClass("field-mapping-"+r),i("input, select, textarea",t).each(function(e,t){var o;if((o=jQuery(t)).attr("name"))return o.attr("name",o.attr("name").replace(/\[([^[]*)\]/,"["+r+"]"))}),r++})},n=function(o){return i(".wc-customer-order-csv-export-field-mapping").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),setTimeout(function(){var e,t;return o="string"==typeof o?JSON.parse(o):o,i(".js-include-all-meta").prop("checked",!0===o.include_all_meta),o.delimiter&&i(".js-row-type").val(o.row_type).trigger("change"),o.row_type&&i(".js-row-type").length&&i(".js-row-type").val(o.row_type).trigger("change"),o.items_format&&i(".js-items-format").length&&i(".js-items-format").val(o.items_format).trigger("change"),v(d.find("tbody tr.field-mapping:not(.field-mapping-__INDEX__)"),!1),t=null!=o.columns?o.columns:null!=o.fields?o.fields:[],e=i.map(t,function(e,t){return"string"==typeof e&&(e={name:e}),e.key||(e.key=t),e}),g(e,r,this,function(){return f(),i(document.body).trigger("wc-enhanced-select-init"),i(".wc-customer-order-csv-export-field-mapping").unblock()})},1)},d.find(".js-add-field-mapping").click(function(e){return e.preventDefault(),r({},!0)}),d.find(".js-remove-field-mapping").click(function(e){var t;return e.preventDefault(),t=d.find('tbody input[type="checkbox"]:checked'),v(t,null,f)}),d.find(".js-load-mapping").click(function(e){return e.preventDefault(),b({title:wc_customer_order_csv_export_admin.i18n.load_mapping,body:i("#tmpl-wc-customer-order-csv-export-modal-body-load-mapping").html(),action:wc_customer_order_csv_export_admin.i18n.load,button_class:"button-primary"})}),i(document.body).on("change","#load-mapping-source",function(e){return"snippet"===i(e.target).val()?i("#load-mapping-snippet").show():i("#load-mapping-snippet").hide()}),i(document.body).on("wc_backbone_modal_response",function(e,t,o){var r;if(r="snippet"===o.source?o.snippet?JSON.parse(o.snippet):{columns:{}}:"empty"===o.source?{columns:{}}:wc_customer_order_csv_export_admin.export_formats[o.source])return setTimeout(function(){return n(r)},1)}),d.find("tbody").sortable({items:"tr",cursor:"move",axis:"y",handle:"td.sort",scrollSensitivity:40,update:f}),d.on("change","select.js-field-key",function(e){var t,o,r,n,a;if(r=(t=i(e.target)).closest("tr").find(".js-field-name"),o=t.closest("td").find(".js-field-meta-key-label"),n=t.closest("td").find(".js-field-static-value-label"),"meta"===t.val()?o.removeClass("hide").find("input").focus():o.addClass("hide").find("input").val(""),"static"===t.val()?n.removeClass("hide").find("input").focus():n.addClass("hide").find("input").val(""),!r.val()||e.removed&&e.removed.id===r.val())return a="meta"===t.val()?"":t.val(),r.val(a)}),i("#mainform").submit(function(e){return i("tr.field-mapping-__INDEX__").remove()}))),"edit-shop_order"===pagenow&&(i('#posts-filter input[type="submit"].action').on("click",function(e){var t,o;if("download_to_csv"===(t=i(e.target).prev("select").val())||"download_to_xml"===t||"export_and_send"===t){if(e.preventDefault(),o=i.map(i("#posts-filter").find('input[name="post[]"]:checked'),function(e){return Number(i(e).val(),10)}),"export_and_send"===t)return c("orders",o);if("download_to_csv"===t)return _("orders","csv",o);if("download_to_xml"===t)return _("orders","xml",o)}}),i(".order_actions .download_to_csv, .wc_actions .download_to_csv").on("click",function(e){var t,o;return e.preventDefault(),t={export_type:"orders",export_method:"download",output_type:"csv"},o=i(this).closest("tr").find('th input[name="post[]"]').val(),l({ids:o},t)}),i(".order_actions .download_to_xml, .wc_actions .download_to_xml").on("click",function(e){var t,o;return e.preventDefault(),t={export_type:"orders",export_method:"download",output_type:"xml"},o=i(this).closest("tr").find('th input[name="post[]"]').val(),l({ids:o},t)})),"shop_order"===pagenow&&i("form#post").submit(function(e){var t,o;if((t=i(this).find('select[name="wc_order_action"]').val())&&("wc_customer_order_export_csv_download"===t||"wc_customer_order_export_xml_download"===t||"wc_customer_order_export_and_send"===t))return e.preventDefault(),o=[woocommerce_admin_meta_boxes.post_id],"wc_customer_order_export_and_send"===t?c("orders",o):"wc_customer_order_export_csv_download"===t?_("orders","csv",o):"wc_customer_order_export_xml_download"===t?_("orders","xml",o):void 0}),"users"===pagenow&&i(".bulkactions #doaction").on("click",function(e){var t,o;if("download_to_csv"===(t=i(e.target).prev("select").val())||"download_to_xml"===t||"export_and_send"===t){if(e.preventDefault(),o=i.map(i(".wp-list-table.users").find('input[name="users[]"]:checked'),function(e){return Number(i(e).val(),10)}),"export_and_send"===t)return c("customers",o);if("download_to_csv"===t)return _("customers","csv",o);if("download_to_xml"===t)return _("customers","xml",o)}}),c=function(n,a){var e;return e=wp.template("wc-customer-order-export-modal-body-automated-action"),b({title:wc_customer_order_csv_export_admin.i18n.automation_action_title,body:e(),cancel:wc_customer_order_csv_export_admin.i18n.cancel,action:wc_customer_order_csv_export_admin.i18n.send,button_class:"button-primary send-export"}),i(document.body).one("wc_backbone_modal_response.handle_automation_action",function(e,t,o){var r;if(o.automation_action_id)return r={export_type:n,export_method:"auto_export",automation_id:o.automation_action_id},l({ids:a},r)})},_=function(n,a,c){var e,t,o;return t=wp.template("wc-customer-order-export-modal-body-download-action"),o="csv"===a?wc_customer_order_csv_export_admin.i18n.download_csv_action_title:wc_customer_order_csv_export_admin.i18n.download_xml_action_title,b({title:o,body:t({output_type:a}),cancel:wc_customer_order_csv_export_admin.i18n.cancel,action:wc_customer_order_csv_export_admin.i18n.download,button_class:"button-primary download-export"}),window.wc_customer_order_csv_export_admin.manual_export_settings[a][n].export_format&&((e=window.wc_customer_order_csv_export_admin.manual_export_settings[a][n]).export_format&&i("#js-download-action-export-format").val(e.export_format),e.filename&&i("#js-download-action-filename").val(e.filename),e.add_notes?i("#js-download-action-add-notes").prop("checked",!0):i("#js-download-action-add-notes").removeProp("checked"),e.batch_enabled?i("#js-download-action-batch-processing").prop("checked",!0):i("#js-download-action-batch-processing").removeProp("checked")),i(document.body).one("wc_backbone_modal_response.handle_download_action",function(e,t,o){var r;if(o.download_action_export_format)return r={export_type:n,output_type:a,export_method:"download",export_format:o.download_action_export_format,filename:o.download_action_filename,add_notes:o.download_action_add_notes,batch_enabled:o.download_action_enable_batch_processing},window.wc_customer_order_csv_export_admin.manual_export_settings[a][n]=r,l({ids:c},r)})},i(document.body).on("wc_backbone_modal_before_remove",function(){var e;if(i(document.body).off("wc_backbone_modal_response.handle_automation_action"),i(document.body).off("wc_backbone_modal_response.handle_download_action"),(e=i("#wc-backbone-modal-dialog").data("wc-customer-order-csv-export-id"))&&x[e])return clearInterval(x[e])})})}).call(void 0);